








<ngx-spinner
  bdColor="rgba(0, 0, 0, 0.8)"
  size="medium"
  color="#fff"
  type="ball-scale-multiple"
  [fullScreen]="true"
>
  <p style="color: white">Loading...</p>
</ngx-spinner>

<div class="agent-page-main-content">
  <div
    class="create-user console-body-wrapper perfect-scrollbar"
    data-scrollbar="data-scrollbar"
  >
    <div class="wider-container pt-5">
      <div class="pb-5 mb-5">
        <form [formGroup]="cardForm" class="user-detail-form">
          <div class="row">
            <div class="row">
              <div class="floating-item mb-4">
                <div class="floating-wrap form-floating mb-2">
                  <select
                    class="form-select disableclass"
                    [(ngModel)]="selectedCity"
                    id="floatingSelect"
                    aria-label="Floating label select"
                    (change)="onChange($event)"
                  >
                    <!-- <option selected   >City </option> -->
                    <option value="1" [selected]="selectedCity === 1">
                      Lahore
                    </option>
                    <option value="2" [selected]="selectedCity === 2">
                      Karachi
                    </option>
                  </select>
                  <label for="floatingSelect"> City</label>
                </div>
              </div>

              <mat-form-field
                class="example-chip-list"
                appearance="fill"
                style="color: rgb(249, 243, 243)"
              >
                <mat-chip-list #chipList aria-label="Fruit selection">
                </mat-chip-list>

                <input
                  placeholder="New Location..."
                  #fruitInput
                  [formControl]="locationCtrl"
                  [matChipInputFor]="chipList"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  (matChipInputTokenEnd)="add($event)"
                  required
                  formControlName="Location"
                  readonly
                  style="cursor: context-menu"
                />

                <mat-select
                  [formControl]="locationCtrl"
                  multiple
                  id="SupportChannelsControl"
                  style="margin: 5px"
                  [(ngModel)]="selectedLocationId"
                >
                  <!-- <mat-select-trigger>
                      <mat-chip-list>
                        <mat-chip *ngFor="let location of locations" 
                          style="background-color:#2F9DF2; color:#ffffff; border-radius: 5px!important;"
                          selected>
                          {{ location}}
                          <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                      </mat-chip-list>
                    </mat-select-trigger> -->

                  <mat-option
                    *ngFor="let location of locations"
                    [value]="location.id"
                    (click)="selectedValues(location.id)"
                  >
                    {{ location.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- <div class="form-floating mb-2 ">
                  <input placeholder="New Location..." #fruitInput [formControl]="locationCtrl" [matAutocomplete]="auto"
                  [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  (matChipInputTokenEnd)="add($event)">
  
                  <mat-select  [formControl]="locationCtrl" multiple
                    id="SupportChannelsControl" style="margin: 10px;">
  
  
                    <mat-select-trigger>
                      <mat-chip-list>
                        <mat-chip *ngFor="let item of selectedItems" 
                          
                          style="background-color:#2F9DF2; color:#ffffff; border-radius: 5px!important;"
                          selected>
                          {{ item }}
                          <mat-icon matChipRemove>cancel</mat-icon>
                        </mat-chip>
                      </mat-chip-list>
                    </mat-select-trigger>
  
                    <mat-option *ngFor="let location of locations" [value]="location.id"
                    (click)="selectedValues(location.name)">
                      {{ location.name }}
                    </mat-option>
                  </mat-select>
       
                </div> -->

              <div class="row align-items-start">
                <div class="col">
                  <div class="card mb-4 disableclass">
                    <div class="card-body">
                      <div
                        class="d-flex align-items-center justify-content-between"
                      >
                        <div>
                          <strong> IBEX 1, IBEX 2, IBEX 3 </strong>
                          <p class="mb-0 coal">Machines</p>
                        </div>
                        <span class="iconButton medium notification iconHover"
                          >06</span
                        >
                      </div>

                      <ul class="list-group mt-3 list-group-flush list-cards">
                        <li class="list-group-item">
                          <div
                            *ngFor="let object of data"
                            
                            (change)="onClick(object.id)"
                          >
                            <div *ngIf="!isHRLoggedIn(); else elseBlock">
                              <input
                                type="checkbox"
                                [checked]="isDevicesSelected(object.id)"
                                [(value)]="object.checked"
                                [required]="true"
                              />

                              {{ object.name }}
                              <code class="float-end"
                                ><small>{{ object.address }}</small></code
                              >
                            </div>
                            <ng-template #elseBlock>
                              <div
                                *ngIf="
                                  object.id == 67 ||
                                    object.id == 68 ||
                                    object.id == 69 ||
                                    object.id == 232;
                                  else else_Block
                                "
                              ></div>
                              <ng-template #else_Block>
                                <div>
                                  <input
                                    type="checkbox"
                                    [checked]="isDevicesSelected(object.id)"
                                    [(value)]="object.checked"
                                    [required]="true"
                                  />

                                  {{ object.name }}
                                  <code class="float-end"
                                    ><small>{{ object.address }}</small></code
                                  >
                                </div>
                              </ng-template>
                            </ng-template>
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <!-- <div class="col">
                    <div class="card mb-4 disableclass">
                      <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                          <div>
                            <strong> IBEX 2</strong>
                            <p class="mb-0 coal"> Machines</p>
  
                          </div>
                          <span class="iconButton medium notification iconHover">04</span>
                        </div>
  
                        <ul class="list-group mt-3 list-group-flush list-cards">
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="firstCheckbox11">
                            <label class="form-check-label" for="firstCheckbox11">Device 1</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="firstCheckbox22">
                            <label class="form-check-label" for="firstCheckbox22">Device 2</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="firstCheckbox33">
                            <label class="form-check-label" for="firstCheckbox33">Device 3</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="firstCheckbox44">
                            <label class="form-check-label" for="firstCheckbox44">Device 4</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
  
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="col">
                    <div class="card mb-4 disableclass">
                      <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                          <div>
                            <strong> IBEX 3</strong>
                            <p class="mb-0 coal"> Machines</p>
  
                          </div>
                          <span class="iconButton medium notification iconHover">07</span>
                        </div>
  
                        <ul class="list-group mt-3 list-group-flush list-cards">
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="c1">
                            <label class="form-check-label" for="c1">Device 1</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="c2">
                            <label class="form-check-label" for="c2">Device 2</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="c3">
                            <label class="form-check-label" for="c3">Device 3</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="c4">
                            <label class="form-check-label" for="c4">Device 4</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="c5">
                            <label class="form-check-label" for="c5">Device 5</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="c6">
                            <label class="form-check-label" for="c6">Device 6</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                          <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" checked id="c7">
                            <label class="form-check-label" for="c7">Device 7</label>
                            <code class="float-end"><small>10.111.30.198</small> </code>
                          </li>
                        </ul>
  
                      </div>
                    </div>
                  </div> -->
              </div>
              <input type="hidden" formControlName="Username" />
              <input type="hidden" formControlName="Password" />
              <input type="hidden" formControlName="Port" />
            </div>

            <!-- <input type="hidden" formControlName="Username" />
              <input type="hidden" formControlName="Password" />
              <input type="hidden" formControlName="Port" />
              <div class="col-md-4">
                <div class="floating-item mb-4">
                  <div class="floating-wrap form-floating mb-2">
                    <select class="form-select disableclass" id="floatingSelect" aria-label="Floating label select"
                      formControlName="Machine">
                      <option value="default" disabled>Select Location</option>
                      <option *ngFor="let d of devices" value="{{ d.ip }}">
                        {{ d.ip }}
                      </option>
  
                    </select>
                    <label for="floatingSelect"> Machine</label>
                  </div>
                </div>
              </div> -->
          </div>

          <!-- <button type="button" class="btn skyBg mb-3 btn-medium authenticate" (click)="authenticate()">
              <i class="fa-light fa-lock-keyhole"></i> Authenticate
              <i class="fa-regular fa-spinner d-none fa-spin"></i>
            </button> -->
          <div class="border mb-4"></div>

          <!-- <div [ngClass]="auth ? 'showinfo d-block' : 'showinfo d-none'"> -->
          <div class="showinfo d-block">
            <div class="floating-item mb-4 col-12">
              <div
                [ngClass]="{
                  'was-validated':
                    cardForm.get('CardNumber')!.valid &&
                    cardForm.get('CardNumber')!.touched
                }"
                class="form-floating mb-2"
              >
                <input
                  [ngClass]="{
                    'is-invalid':
                      cardForm.get('CardNumber')!.errors &&
                      (cardForm.get('CardNumber')!.touched ||
                        cardForm.get('CardNumber')!.dirty)
                  }"
                  class="form-control"
                  id="last-name"
                  placeholder="Device1"
                  value="Device1"
                  formControlName="CardNumber"
                />
                <label for="lastt-name"
                  >CardNumber<sup class="radical">*</sup></label
                >
                <div
                  class="invalid-feedback"
                  *ngIf="
                    cardForm.get('CardNumber')!.errors &&
                    (cardForm.get('CardNumber')!.touched ||
                      cardForm.get('CardNumber')!.dirty)
                  "
                >
                  <div
                    *ngIf="cardForm.get('CardNumber')!.errors?.['maxlength'] || 
                      cardForm.get('CardNumber')!.errors?.['minlength']"
                  >
                    Device Card Number must be 10 digit add 0's before
                    cardNumber
                  </div>

                  <div *ngIf="cardForm.get('CardNumber')!.errors?.['required']">
                    Card Number is required!
                  </div>
                </div>
                <div
                  class="valid-feedback"
                  *ngIf="
                    cardForm.get('CardNumber')!.valid &&
                    cardForm.get('CardNumber')!.touched
                  "
                >
                  Looks Good!
                </div>
              </div>
            </div>
            <div class="floating-item mb-4">
              <div class="form-floating mb-2">
                <input
                  [ngClass]="{
                    'is-invalid':
                      cardForm.get('EmployeeNumber')!.errors &&
                      (cardForm.get('EmployeeNumber')!.touched ||
                        cardForm.get('EmployeeNumber')!.dirty)
                  }"
                  class="form-control"
                  id="empnumber"
                  placeholder="Card Number"
                  formControlName="EmployeeNumber"
                />
                <label for="empnumber"
                  >Employee Number<sup class="radical">*</sup>
                </label>
                <div
                  class="invalid-feedback"
                  *ngIf="
                    cardForm.get('EmployeeNumber')!.errors &&
                    (cardForm.get('EmployeeNumber')!.touched ||
                      cardForm.get('EmployeeNumber')!.dirty)
                  "
                >
                  <div
                    *ngIf="cardForm.get('EmployeeNumber')!.errors?. ['required']"
                  >
                    Employee Number is required!
                  </div>
                </div>
                <div
                  class="valid-feedback"
                  *ngIf="
                    cardForm.get('EmployeeNumber')!.valid &&
                    cardForm.get('EmployeeNumber')!.touched
                  "
                >
                  Looks Good !
                </div>
              </div>
            </div>
            <div class="floating-item mb-4"></div>
            <div class="form-floating mb-4">
              <input
                class="form-control"
                id="empname"
                placeholder="Card Number"
                formControlName="EmployeeName"
              />
              <label for="empname"
                >Employee Name<sup class="radical">*</sup>
              </label>
            </div>

            <!-- <div class="form-floating mb-2">
                <div class="daterangepicker fullwidthdp">
                  <label for="birthdaytime">Expiry Date</label>
                  <input
                    class="form-control"
                   
                    placeholder="Expiry Date"
                    formControlName="ExpiryDate"y
                 
                  />
                </div>
              </div> -->
            <div class="form-floating mt-3">
              <div
                class="daterangepicker fullwidthdp"
                *ngIf="isAdminLoggedIn()"
              >
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label
                    ><span style="font-size: 18px"> ExpiryDate</span></mat-label
                  >
                  <input
                    matInput
                    [matDatepicker]="picker"
                    formControlName="ExpiryDate"
                    readonly
                  />

                  <mat-datepicker-toggle matIconSuffix [for]="picker">
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-datepicker-toggle>
                </mat-form-field>
              </div>
            </div>
            <!-- <div class="form-floating mb-4">
               
               <div class="mb-4 upload-files">
                
                <label for="empname">Upload Employee image<sup class="radical">*</sup> </label>
            <input class="form-control custom-choose-file" type="file" id="formFile"  (change)="onFileChanged($event)">
            
  
            <small class="silver">Max file size is 2 MB. Best size for image upload is 512*512px, Make sure the face is visible for face detection!</small>
          </div>
        </div> -->
            <div class="col-md-5">
              <div class="em-holder">
                <img [src]="url" *ngIf="url" class="img-fluid" />
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <footer class="footer">
    <div class="ps-3 pe-3">
      <div
        class="icon-buttons-wrapper d-flex justify-content-between pt-3 pb-4"
      >
        <div class="row w-100">
          <div class="col-md-4"></div>
          <div class="col-md-8 justify-content-end d-flex">
            <div class="buttons-wrap d-flex">
              <button
                type="button"
                class="btn btn-outline-secondary btn-medium me-2 px-4"
                data-bs-toggle="modal"
                data-bs-target="#cancel-changes"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-success ms-e f-saveBtn btn-large d-none"
              ></button>
              <button
                type="button"
                class="btn skyBg ms-2 px-4 btn-medium saveBtn"
                data-bs-toggle="modal"
                data-bs-target="#edit-device"
                [disabled]="cardForm.invalid"
              >
                Save
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
</div>

<div
  class="modal fade"
  id="cancel-changes"
  tabindex="-1"
  aria-labelledby="cancel-changes-Label"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title line-head" id="cancel-changes-Label">Confirm</h5>
        <button
          type="button"
          class="btn iconHover pt-0 pb-0"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <i class="fal fa-times"></i>
        </button>
      </div>
      <div class="modal-body p-5">
        <div class="d-flex align-items-center">
          <div class="icon-circle iconButton me-4 errorbg">
            <i class="fal fa-times"></i>
          </div>
          <p class="line-txt darkblue">
            Are you sure, you want to cancel the changes?
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
          routerLink="/dashboard/cardmanagement/listofcards"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-danger modal_cancel-card"
          data-bs-dismiss="modal"
          routerLink="/dashboard/cardmanagement/listofcards"
        >
          Yes
        </button>
      </div>
    </div>
  </div>
</div>
<div
  class="modal fade"
  id="edit-device"
  tabindex="-1"
  aria-labelledby="saveModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title line-head" id="saveModalLabel">Confirm</h5>
        <button
          type="button"
          class="btn iconHover pt-0 pb-0"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <i class="fal fa-times"></i>
        </button>
      </div>
      <div class="modal-body p-5">
        <div class="d-flex align-items-center">
          <div class="icon-circle iconButton me-4">
            <i class="fal fa-clipboard-check"></i>
          </div>
          <p class="line-txt darkblue">
            Are you sure, you want to save changes?
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn skyBg modal_card-save"
          data-bs-dismiss="modal"
          (click)="submitform()"
        >
          Yes
        </button>
      </div>
    </div>
  </div>
</div>
